# 年份过滤使用指南

**版本**: v4.3.0
**日期**: 2025-11-13
**作者**: Meng Linghan

---

## 📖 功能概述

年份过滤工具用于从WOS格式文献数据中筛选特定年份范围的记录，自动识别并移除异常年份的文献（如Early Access在线先发表文章、历史引用文献等）。

### 核心功能

- ✅ **灵活的年份范围设置**：支持自定义年份范围（如2015-2024）
- ✅ **异常检测**：自动识别Early Access（2025-2026）和历史文献（pre-2015）
- ✅ **详细报告**：生成完整的年份分布和过滤统计
- ✅ **WOS格式兼容**：保留WOS格式，可直接用于VOSviewer/CiteSpace
- ✅ **工作流集成**：已集成到一键式AI工作流

---

## 🎯 使用场景

### 场景1：数据包含异常年份

**问题**：Scopus检索结果包含2025-2026年的Early Access文章和历史文献
- 影响年份趋势分析
- 影响论文方法部分的数据描述

**解决**：使用年份过滤工具，只保留目标年份范围（如2015-2024）

### 场景2：需要特定时间段的数据

**需求**：只分析最近5年或10年的文献
- 研究近期趋势
- 聚焦特定时期的研究热点

**解决**：灵活设置年份范围

---

## 🚀 快速开始

### 方法1：独立使用（推荐用于已有数据文件）

```bash
# 基本用法 - 指定年份范围
python3 filter_by_year.py input.txt output.txt --year-range 2015-2024

# 生成文件：
#   - output.txt: 过滤后的数据文件
#   - output_year_filter_report.txt: 详细报告
```

### 方法2：集成工作流使用（推荐用于新项目）

```bash
# 完整工作流 + 年份过滤
python3 run_ai_workflow.py \
  --data-dir "/path/to/data" \
  --year-range 2015-2024

# 自动执行：
#   1. 格式转换 + WOS标准化
#   2. AI机构信息补全
#   3. 合并去重
#   4. 语言筛选
#   5. 机构清洗
#   6. 年份过滤 ⭐ NEW
#   7. 统计分析
```

---

## 📝 详细用法

### 参数说明

#### 必选参数

- `input_file`：输入文件路径（WOS格式）
- `output_file`：输出文件路径

#### 年份范围参数（三选一）

**选项1：使用 `--year-range`（推荐）**
```bash
python3 filter_by_year.py input.txt output.txt --year-range 2015-2024
```

**选项2：使用 `--min-year` 和 `--max-year`**
```bash
python3 filter_by_year.py input.txt output.txt --min-year 2015 --max-year 2024
```

**选项3：只指定最小或最大年份**
```bash
# 只保留2015年及以后的
python3 filter_by_year.py input.txt output.txt --min-year 2015

# 只保留2024年及以前的
python3 filter_by_year.py input.txt output.txt --max-year 2024
```

#### 可选参数

- `--report`：指定报告文件路径（默认自动生成）
- `--log-level`：日志级别（DEBUG/INFO/WARNING/ERROR，默认INFO）

---

## 📊 输出文件说明

### 1. 过滤后的数据文件

**文件名**：您指定的`output_file`（如`filtered_2015-2024.txt`）

**格式**：WOS纯文本格式（UTF-8 BOM）

**用途**：
- 直接导入VOSviewer进行可视化分析
- 导入CiteSpace进行文献计量分析
- 导入Bibliometrix进行统计分析

### 2. 过滤报告

**文件名**：`output_file_year_filter_report.txt`

**内容**：
```
============================================================
年份过滤报告
============================================================

过滤条件:
------------------------------------------------------------
最小年份: 2015
最大年份: 2024

过滤统计:
------------------------------------------------------------
原始记录总数: 660
保留记录数: 343
过滤掉记录数: 317
过滤率: 48.03%

原始年份分布:
------------------------------------------------------------
1984:    1 篇 [✗ 过滤]
...
2015:    5 篇 [✓ 保留]
...
2024:  104 篇 [✓ 保留]
2025:  272 篇 [✗ 过滤]
2026:    1 篇 [✗ 过滤]

被过滤的年份分布:
------------------------------------------------------------
1984:    1 篇
...
2025:  272 篇
2026:    1 篇
```

### 3. 重新分析报告（仅工作流模式）

**文件名**：`*_Year_Filtered_analysis_report.txt`

**内容**：过滤后数据的完整统计分析
- 年份分布（仅包含保留的年份）
- 国家分布
- 机构分布
- 作者分布

---

## 💡 实际案例

### 案例：2015-2024 NANO NSCLC IMMUNE项目

**背景**：
- 项目名称包含"2015-2024"，但Scopus数据包含异常年份
- 原始数据：660篇

**问题发现**：
```
年份分布异常：
- 1984-2014年：44篇（历史文献）
- 2025年：272篇（Early Access）
- 2026年：1篇（Early Access）
```

**解决方案**：
```bash
python3 run_ai_workflow.py \
  --data-dir "/path/to/2015-2024 NANO NSCLC IMMUNE" \
  --year-range 2015-2024
```

**结果**：
- ✅ 保留记录：343篇（2015-2024）
- ✅ 过滤掉：317篇（48.03%）
- ✅ 年份分布准确，符合研究设计

**输出文件**：
```
项目目录/
├── Final_Version_Year_Filtered.txt           # 推荐用于分析
├── Final_Version_Year_Filtered_analysis_report.txt
└── Final_Version_Year_Filtered_year_filter_report.txt
```

---

## ⚠️ 注意事项

### 1. Scopus数据包含异常年份的原因

**Early Access文章**（2025-2026年）：
- 文章已在线发表，但官方出版日期标记为未来年份
- 虽然技术上属于"当前可获得"的文献，但会影响趋势分析

**历史文献**（远早于检索范围）：
- Scopus检索时可能包含被高频引用的经典文献
- 虽然相关性高，但不符合年份范围要求

### 2. 何时使用年份过滤

**必须使用**：
- 论文方法部分明确声明年份范围（如"2015-2024年文献"）
- 进行年份趋势分析
- 需要严格控制数据时间跨度

**可选使用**：
- 探索性分析，包含所有相关文献
- Early Access文章是研究重点

### 3. 年份过滤的顺序

**推荐顺序**（已在工作流中实现）：
1. 格式转换
2. AI补全
3. 合并去重
4. 语言筛选
5. 机构清洗
6. **年份过滤** ← 在这一步
7. 统计分析

**原因**：先完成其他处理，最后再过滤年份，确保所有增强都已应用。

---

## 🔧 高级用法

### 只过滤掉Early Access文章

```bash
# 只保留2024年及以前的
python3 filter_by_year.py input.txt output.txt --max-year 2024
```

### 只保留最近5年

```bash
# 2020-2024
python3 filter_by_year.py input.txt output.txt --year-range 2020-2024
```

### 分析不同年份范围的影响

```bash
# 生成多个年份范围的数据集进行对比
python3 filter_by_year.py input.txt output_2015-2024.txt --year-range 2015-2024
python3 filter_by_year.py input.txt output_2020-2024.txt --year-range 2020-2024
python3 filter_by_year.py input.txt output_all_to_2024.txt --max-year 2024
```

---

## 🆘 常见问题

### Q1：为什么Scopus数据包含2025-2026年的文章？

**答**：这些是Early Access（在线先发表）文章。虽然已发表，但官方出版年份标记为未来。

### Q2：是否应该包含Early Access文章？

**答**：取决于研究设计：
- 如果研究声明"截至2024年的文献"：**应过滤**
- 如果研究包含"最新可获得文献"：**可保留**

### Q3：过滤后文章数量大幅减少，正常吗？

**答**：正常。以2015-2024 NANO NSCLC IMMUNE项目为例：
- 过滤率48.03%
- 主要来自272篇2025年Early Access文章
- 这正是年份过滤的目的

### Q4：年份过滤会影响AI补全的数据吗？

**答**：不会。工作流顺序确保：
1. 先进行AI补全（所有数据）
2. 再过滤年份
3. 补全的信息已保存在过滤后的记录中

---

## 📚 相关文档

- **CHANGELOG.md**：v4.3.0版本更新日志
- **CLAUDE.md**：完整技术文档
- **快速使用指南.md**：项目总体使用指南
- **AI补全系统完整总结.md**：AI功能详解

---

## 🎓 论文写作参考

### 方法部分示例

**未使用年份过滤时**：
> "从Scopus和Web of Science数据库检索了660篇文献..."

**使用年份过滤后**：
> "从Scopus和Web of Science数据库检索了2015年1月至2024年12月期间的文献。在去除重复记录和Early Access在线先发表文章后，最终纳入343篇文献进行分析..."

### 数据筛选流程图示例

```
Scopus (574篇) + WOS (213篇)
          ↓
   合并去重 (667篇)
          ↓
   语言筛选 (660篇，English)
          ↓
   机构清洗 (660篇)
          ↓
   年份过滤 (343篇，2015-2024) ← 新增步骤
          ↓
   最终分析数据集
```

---

## 📞 技术支持

如有问题或建议，请：
1. 查阅本指南的"常见问题"部分
2. 查看CHANGELOG.md了解最新更新
3. 提交Issue到GitHub仓库

---

**版本历史**：
- v4.3.0 (2025-11-13): 首次发布年份过滤功能
