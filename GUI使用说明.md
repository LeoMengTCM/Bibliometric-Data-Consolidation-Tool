# MultiDatabase GUI 使用说明

**版本**: v1.0
**日期**: 2025-11-13
**适用系统**: macOS

---

## 🎨 界面预览

MultiDatabase GUI 提供了一个现代化、美观的图形界面，让您无需记忆命令行参数，只需点击几下鼠标即可完成所有操作！

**界面特点**：
- 🌙 深色主题（Mac风格）
- 📱 清晰的布局
- 📊 实时日志输出
- ⚡ 简单易用

---

## 🚀 快速开始

### 方法1: 双击启动（推荐）

1. **找到文件**: `启动GUI.command`
2. **双击运行**: 系统会自动检查并安装依赖，然后启动GUI

首次运行会自动安装 `customtkinter` 库，稍等片刻即可。

### 方法2: 命令行启动

```bash
cd /Users/menglinghan/Desktop/MultiDatabase
python3 gui_app.py
```

---

## 📋 使用步骤

### 步骤1: 选择输入文件夹

点击 **"📁 输入文件夹"** 右侧的 **"浏览..."** 按钮，选择包含以下两个文件的文件夹：
- `wos.txt` - WOS数据库导出的文件
- `scopus.csv` - Scopus数据库导出的文件

**示例路径**:
```
/Users/menglinghan/Library/CloudStorage/OneDrive-共享的库-Onedrive/文献计量学/2015-2024 NANO NSCLC IMMUNE/
```

### 步骤2: 选择输出文件夹（可选）

点击 **"💾 输出文件夹"** 右侧的 **"浏览..."** 按钮。

**说明**:
- **留空**: 输出文件将保存在输入文件夹
- **指定文件夹**: 输出文件将保存到指定位置（会自动复制输入文件）

**推荐**: 留空，直接在原文件夹生成结果

### 步骤3: 配置参数

#### 📅 年份范围
- **起始年**: 例如 `2015`
- **结束年**: 例如 `2024`
- **作用**: 只保留该年份范围内的文献，移除Early Access和历史文献

#### 🌐 目标语言
- **English** (推荐) - 只保留英文文献
- **Chinese** - 只保留中文文献
- **其他语言** - German, French, Spanish, Japanese

#### 🧹 清洗规则
- **ultimate (终极清洗)** ⭐ 推荐 - 最彻底的清洗
- **enhanced (增强清洗)** - 保留更多细节
- **basic (基础清洗)** - 保守清洗

### 步骤4: 功能开关

| 开关 | 功能 | 推荐 |
|------|------|------|
| ✨ **AI智能补全机构信息** | 补全州代码、邮编、部门等 | ✅ 开启 |
| 🧹 **机构名称清洗** | 合并重复机构、统一格式 | ✅ 开启 |
| 📊 **生成文档类型分析图** | 生成TIFF/PNG图表 | 可选 |

**说明**:
- **AI补全**: 第一次运行需要调用AI，后续100%使用缓存，速度极快
- **机构清洗**: 减少20%+的重复机构，提高VOSviewer分析质量
- **生成图表**: 需要matplotlib库，如果安装了会自动生成

### 步骤5: 开始处理

点击 **"🚀 开始处理"** 按钮。

系统会弹出确认对话框，确认无误后点击 **"是"**。

### 步骤6: 查看进度

处理过程中：
- **状态栏**: 显示 "处理中..."（橙色）
- **日志窗口**: 实时显示处理进度
- **开始按钮**: 变为 "⏳ 处理中..." 并禁用

### 步骤7: 完成

处理完成后：
- **状态栏**: 显示 "✓ 处理完成！"（绿色）
- **弹窗提示**: 显示输出文件位置
- **日志窗口**: 显示推荐使用的文件

---

## 📁 输出文件

处理完成后，在输出文件夹中会生成以下文件：

| 文件名 | 说明 | 推荐度 |
|--------|------|--------|
| `Final_Version_Year_Filtered.txt` | 年份过滤后的最终数据 | ⭐⭐⭐⭐⭐ |
| `Final_Version_Year_Filtered_analysis_report.txt` | 统计分析报告 | ⭐⭐⭐⭐⭐ |
| `Final_Version.txt` | 机构清洗后的数据 | ⭐⭐⭐ |
| `english_only.txt` | 语言筛选后的数据 | ⭐⭐⭐ |
| `merged_deduplicated.txt` | 合并去重后的数据 | ⭐⭐ |
| `scopus_enriched.txt` | AI补全后的Scopus数据 | ⭐⭐ |
| `scopus_converted_to_wos.txt` | 转换后的Scopus数据 | ⭐⭐ |

**推荐使用**:
- **VOSviewer/CiteSpace分析**: `Final_Version_Year_Filtered.txt`
- **论文写作参考**: `Final_Version_Year_Filtered_analysis_report.txt`

---

## 🔧 功能详解

### AI智能补全

**补全内容**:
- 州/省代码（FL, CA, Hunan等）
- 邮政编码（32804, 410208等）
- 部门信息（Dept Oncol, Sch Med等）
- WOS标准缩写（Univ, Inst, Hosp等）

**性能**:
- 第1次运行: 约10分钟（建立数据库）
- 第2次运行: <5秒（100%缓存命中）
- 成本: 第1次¥0.14/1000篇，后续¥0

### 机构名称清洗

**清洗效果**:
- 合并父子机构（Harvard Medical School → Harvard University）
- 统一名称变体（Sun Yat Sen → Sun Yat-Sen）
- 去除重复（同一机构出现多次 → 只保留一次）
- 移除独立部门（Department of XXX → 移除）

**实际效果**:
- 总机构数: -20%
- 唯一机构数: -5%
- VOSviewer网络图更清晰

### 年份过滤

**典型应用**:
- 移除2025-2026年的Early Access文章
- 移除历史文献（如2015年之前）
- 符合论文研究时间范围（如"2015-2024年文献"）

**示例结果**:
- 输入: 660条
- 保留: 343条（2015-2024年）
- 过滤: 317条（272篇2025年 + 45篇历史文献）

---

## ⚙️ 系统要求

### 必需环境
- **操作系统**: macOS 10.14+
- **Python**: 3.6+
- **磁盘空间**: 至少500MB

### 必需库
- `customtkinter` - GUI界面（自动安装）
- `requests` - AI功能
- 其他标准库（Python自带）

### 可选库
- `matplotlib` - 生成图表（如需生成图表功能）

---

## 🐛 故障排除

### 问题1: 双击 `启动GUI.command` 没反应

**解决方法**:
```bash
cd /Users/menglinghan/Desktop/MultiDatabase
chmod +x 启动GUI.command
./启动GUI.command
```

### 问题2: 提示缺少 customtkinter

**解决方法**:
```bash
pip3 install customtkinter
# 或
pip3 install --break-system-packages customtkinter
```

### 问题3: 无法选择文件夹

**解决方法**:
- 检查文件夹是否存在
- 确认您有读取权限
- 重启GUI应用

### 问题4: 处理失败

**检查**:
1. 输入文件夹中是否有 `wos.txt` 和 `scopus.csv`
2. 文件是否为UTF-8编码
3. 查看日志窗口中的错误信息

---

## 💡 使用技巧

### 技巧1: 快速测试

第一次使用时，建议：
1. 使用小数据集测试（如50-100篇文献）
2. 关闭AI补全（更快）
3. 查看输出文件是否正确

### 技巧2: 批量处理

处理多个项目时：
1. 第1个项目：开启AI补全，建立数据库
2. 后续项目：数据库命中率高，速度极快

### 技巧3: 自定义清洗规则

如需自定义机构清洗规则：
1. 编辑 `config/institution_cleaning_rules_ultimate.json`
2. 添加您的规则
3. 重新运行GUI

### 技巧4: 查看详细日志

如需更详细的日志：
1. 命令行运行: `python3 gui_app.py`
2. 查看终端输出

---

## 📊 性能参考

| 数据量 | AI补全（首次） | AI补全（缓存） | 总耗时 |
|--------|---------------|---------------|--------|
| 100篇 | ~2分钟 | <1秒 | ~3分钟 |
| 500篇 | ~8分钟 | <3秒 | ~10分钟 |
| 1000篇 | ~15分钟 | <5秒 | ~20分钟 |

**注**: 缓存命中时（第2次运行相同领域数据），耗时大幅减少

---

## 🆘 获取帮助

### 文档
- `快速开始.md` - 5分钟上手指南
- `项目结构说明.md` - 项目详细说明
- `AI工作流完整说明.md` - 处理流程详解

### 命令行版本
如果GUI不符合需求，可以使用命令行版本：
```bash
python3 run_ai_workflow.py --data-dir "/path/to/data" --year-range 2015-2024
```

---

## ✨ 界面截图说明

### 主界面布局

```
┌─────────────────────────────────────────────────────┐
│  📊 MultiDatabase 文献计量工具                       │
│  AI增强 | WOS标准化 | 一键处理 | 专业输出              │
├─────────────────────────────────────────────────────┤
│  📁 输入文件夹:  [________________] [浏览...]        │
│  💾 输出文件夹:  [________________] [浏览...]        │
├─────────────────────────────────────────────────────┤
│  ⚙️ 处理参数                                        │
│    📅 年份范围: [2015] 到 [2024]                    │
│    🌐 目标语言: [English ▼]                          │
│    🧹 清洗规则: [ultimate (终极清洗) ▼]             │
├─────────────────────────────────────────────────────┤
│  🔧 功能开关                                         │
│    [✓] ✨ AI智能补全机构信息                         │
│    [✓] 🧹 机构名称清洗                              │
│    [✓] 📊 生成文档类型分析图                        │
├─────────────────────────────────────────────────────┤
│  📋 处理日志                                         │
│  ┌─────────────────────────────────────────────┐   │
│  │ 2025-11-13 15:00:14 - INFO - 开始处理...    │   │
│  │ 2025-11-13 15:00:15 - INFO - 转换完成       │   │
│  │ ...                                          │   │
│  └─────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────┤
│  [🚀 开始处理] [🗑️ 清空日志] [❌ 退出]              │
│                                                      │
│  状态: 就绪                                          │
└─────────────────────────────────────────────────────┘
```

---

**最后更新**: 2025-11-13
**版本**: v1.0
**作者**: Meng Linghan
